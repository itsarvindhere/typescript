In the last section, we saw how we had to add 'DOM' to the 'lib' array in tsConfig to get rid of the error on 'document'. We had to do that because when we manually specify the 'lib' option, TypeScript stops including the default libraries, which includes 'DOM'. So, if you are working with web APIs, you need to make sure to include 'DOM' in the 'lib' array, otherwise TypeScript will not recognize any DOM related objects or methods.

Now, let's say we have this code -

    const elements = document.querySelectorAll('div');

    for (const element of elements) {
        element.innerText = 'Hello World';
    }

At first glance, everything seems fine. There is no error on 'document' because we have already added 'DOM' to the 'lib' array. But, now there is a different error and this one is for the for loop. We see that the error in IDE says -

    Type 'NodeListOf<HTMLDivElement>' must have a '[Symbol.iterator]()' method that returns an iterator.

Interesting. What is this all about now?

The 'elements' variable is of type 'NodeListOf<HTMLDivElement>', which is the return type of 'document.querySelectorAll' method.

If we ctrl + click on 'NodeListOf', we will be taken to its definition in the TypeScript declaration files. There, we can see that 'NodeListOf' interface has this -

    interface NodeListOf<TNode extends Node> extends NodeList {
        item(index: number): TNode;
        forEach(callbackfn: (value: TNode, key: number, parent: NodeListOf<TNode>) => void, thisArg?: any): void;
        [index: number]: TNode;
    }

As per the error message, TypeScript is expecting 'NodeListOf' to have a '[Symbol.iterator]()' method that returns an iterator, so that it can be used in a for...of loop.

But as we can see, 'NodeListOf' does not have that method defined. So, TypeScript is complaining.

Now, if you look at the folder where we have the 'lib.dom.d.ts' file (you can find it in the TypeScript installation folder under 'lib'), you will see another file named 'lib.dom.iterable.d.ts'. Inside that, if you look for the 'NodeListOf' interface, it is like this -

    interface NodeListOf<TNode extends Node> {
        [Symbol.iterator](): ArrayIterator<TNode>;
        /** Returns an array of key, value pairs for every entry in the list. */
        entries(): ArrayIterator<[number, TNode]>;
        /** Returns an list of keys in the list. */
        keys(): ArrayIterator<number>;
        /** Returns an list of values in the list. */
        values(): ArrayIterator<TNode>;
    }

So here, we can see that 'NodeListOf' does have the '[Symbol.iterator]()' method defined, but it is in a different declaration file - 'lib.dom.iterable.d.ts'.

So, how do we make TypeScript aware of this file?

Well, remember that for such use case, we can use the 'lib' compiler option in tsConfig. Right now, our tsconfig.json has this -

    "target": "es2015",
    "lib": ["ES2021", "DOM"]

So, we are including 'ES2021' and 'DOM' libraries, but not 'DOM.Iterable'. So, we have to add 'DOM.Iterable' to the 'lib' array like this -

    "lib": ["ES2021", "DOM", "DOM.Iterable"]

And that's it! The error goes away now.

So, the question should be, why is the iterable functionality of 'NodeListOf' not included in the default 'DOM' library?

Well, one reason can be that 'iterables' and 'iterators' were added in JavaScript in ES2015. And remember that TypeScript was released in 2012, before ES2015. So, the initial versions of TypeScript did not have support for iterables and iterators.

So, to maintain backward compatibility, TypeScript team decided to keep the iterable functionality in a separate declaration file - 'lib.dom.iterable.d.ts'. This way, projects that do not need iterable functionality can avoid including it, while projects that do need it can include it explicitly.