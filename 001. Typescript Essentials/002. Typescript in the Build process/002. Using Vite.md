What is Vite?

Well, Vite is a build tool that allows us to develop and bundle our JavaScript applications quickly and efficiently. It is especially popular for modern web development because it provides a fast development experience with features like hot module replacement (HMR).

Vite comes with a really good support for TypeScript out of the box, meaning we can use TypeScript in our Vite projects without any additional configuration.

To get started, we can create a new Vite project using -

    npm create vite@latest

This will prompt us to choose a project name. After that, it will ask you to select a framework. We can choose "vanilla" for now. Finally, it will ask if we want to use TypeScript or JavaScript. We should select TypeScript.

And once all that is done, it will create a new directory with the project name we provided, and inside that directory, we will find a basic Vite project structure with TypeScript support.

There will be one 'public' directory, and one 'src'. The 'src' just has a couple of .ts files like main.ts, and counter.ts. Then there is also a style.css file, and finally a 'vite-env.d.ts' file which is used to define the types for Vite environment variables.

To run the project, we have to first install the dependencies by opening a new terminal in the project directory and running:

    npm install

Note that the dependencies are defined in the package.json file, which was created by Vite when we set up the project. Inside that file, Vite also creates some scripts like these -

     "scripts": {
        "dev": "vite",
        "build": "tsc && vite build",
        "preview": "vite preview"
    }

We can run any of these scripts using npm -

    npm run <script-name>

For example, if we want to start the development server, we can run:

    npm run dev

And this will start a new development server at some port (usually 5173). We can then open our browser and navigate to that port to see our application running.

There are some fantastic features that Vite provides, such as:

1. **Hot Module Replacement (HMR)**: This allows us to see changes in our code without refreshing the entire page, making development much faster and smoother.
2. **Fast Build Times**: Vite uses a modern build process that is optimized for speed, allowing us to build our applications quickly.
3. **Out-of-the-box TypeScript Support**: Vite has built-in support for TypeScript, so we can use TypeScript features without any additional configuration.

If you are wondering what about 'tsc', then remember that 'tsc' just compiles our TypeScript code to JavaScript and that's it.

On the other hand, Vite will not just compile, but also bundle + optimize + run a dev server with instant reloads.

One thing you will notice is that if you go to the index.html file in the root of the project, you will see that it has a script tag that points to the 'main.ts' file. It does not have a .js extension, which is a bit different from traditional setups.

But, didn't we say that Browsers do not understand TypeScript? Yes, they don't. 

When you run 'npm run dev', there are some things that Vite does under the hood -

1. It runs a small dev server that serves the index.html file.
2. When the browser sees the script tag pointing to 'main.ts', it will request for that file, and Vite intercepts that request. Then, Vite uses 'esbuild' (a fast JavaScript bundler) to compile the TypeScript code to JavaScript on the fly before it sends it to the browser.


So when you check the page source or “View HTML” in DevTools, you’ll see:


    <script type="module" src="/src/main.ts"></script>

But, if you see the network tab in devtools, you will actually see that the 'main.ts' file content is actually Javascript code, not TypeScript. Vite handles this conversion seamlessly, so we can write our code in TypeScript while the browser receives JavaScript.

But why Vite does all this?

The main reason is instant startup. Vite does not have to compile your entire application by going over every typeScript file before starting the dev server.

There is also on-demand compilation, which means that Vite only compiles the files that are actually requested by the browser. This is why Vite is so fast during development.

When you change one file, Vite only recompiles that file and sends the updated JavaScript to the browser, which is why you see the changes instantly without a full page reload.

Things do change in production because for production, you have to build your application using:

    npm run build

And in this case, Vite does not server .ts files at all. You will see that when you run the build command, Vite will compile all your TypeScript files to JavaScript and bundle them (using Rollup) into a single file (or multiple files) that can be served to the browser. All these files will be kept in the 'dist' directory.

So, that's the main idea behind Vite. The speed is one reason why it has become so popular in the JavaScript community, especially for TypeScript projects. It allows us to focus on writing code without worrying about the build process, and it provides a great development experience with its fast feedback loop.

# WAIT, WHY IS TSC COMMAND NOT GENERATING JS FILES?

If you head to the terminal and head to the 'src' folder which has a couple of 'ts' files and run:

    tsc

You won't see any new 'js' files being generated in the 'dist' directory or anywhere in the project. The reason is an option inside 'tsconfig.json' file which is set to true by default in Vite projects:

    "noEmit": true

It tells tsc "don’t actually output .js files when compiling". Remember that Vite never asks 'tsc' to generate JavaScript — it uses 'esbuild' for that instead. So, TypeScript is only used for type checking, not for code emission.

This is how Vite handles TypeScript -

    1. Vite uses esbuild to convert .ts → .js super quickly (without type checking).This happens on-the-fly in dev mode, and during build mode before bundling
    2. If you want type-checking, you can run `tsc` to check types without generating .js files. This is useful for catching type errors during development.

This separation makes dev mode instant because type checking can be slow.

If you removed "noEmit": true and ran tsc, TypeScript would output .js files next to your .ts files or in a dist/ folder. You’d have two build systems writing JS — 'tsc' and 'esbuild' — which would be redundant and potentially cause conflicts.

So, if you want to check types, you can run:

    tsc

Or even better, run it in watch mode:

    tsc --watch

And let Vite handle the JavaScript emission with esbuild.

So, the bottom-line is -

    Vite says — “I’ll handle JS emission with esbuild; TypeScript, you just check types.”
    That’s why "noEmit": true is the default in a Vite setup.

    So, in a Vite setup, TypeScript is more like a Linter that checks types, while Vite (with esbuild) is the one that actually compiles and serves the JavaScript code.

And all this is really helpful is a CI/CD setup where you can run 'tsc' to ensure type safety before any code is deployed, without worrying about generating unnecessary JavaScript files. 

For example, if you have GitHub actions set up, you can add a step to run 'tsc' to check types before deploying your application. If there are any type errors, the deployment will fail, ensuring that only type-safe code is deployed to production.

# SHOULD TYPESCRIPT BLOCK YOUR DEV SERVER?

Well, in our Vite project, if there is any TypeScript error, the dev server will still start, and you can continue developing your application.

But, if there is any TypeScript errors, should it block the dev server?

By default, Vite does not block the dev server on TypeScript errors because it allows developers to continue working on their code without being blocked by type errors. This is especially useful during development when you might be in the middle of implementing a feature and don't want to be blocked by type errors.

There is a  way to change this behavior by creating a new file called 'vite.config.ts' in the root of your project and adding the following configuration:

    import checker from 'vite-plugin-checker'

    export default {
    plugins: [
        checker({ typescript: true }),
        ]
    }

You will also need to install the 'vite-plugin-checker' package by running:

    npm install vite-plugin-checker --save-dev

So, what is going on here?

Well, first of all, out of the box, Vite does not have a built-in way to block the dev server on TypeScript errors.

But, there is a plugin called 'vite-plugin-checker' that can be used to add this functionality. So, now, if there are any TypeScript errors, they will be shown in the terminal and the browser even though the dev server is running. This way, you can see the errors in real-time and fix them without having to stop the dev server.

But, should you really block the dev server on TypeScript errors? Well, it depends on your workflow and team preferences. Some teams prefer to have the dev server blocked on type errors to ensure that only type-safe code is being developed and tested. This can help catch errors early and prevent them from being deployed to production.

On the other hand, some teams prefer to allow the dev server to run even if there are type errors, as it can speed up development and allow for more rapid iteration. In this case, it's important to have good testing and code review practices in place to catch any potential issues before they make it to production.

Ultimately, it's up to you and your team to decide what approach works best for your development process.

What you can instead do is run your dev server and also side by side, run the TypeScript compiler in watch mode to catch any type errors early. This way, you can have the best of both worlds - a fast dev server for rapid iteration and a TypeScript compiler to ensure type safety.

This is how you can do this by just one script. First, install this npm package -

    npm install --dev npm-run-all

This package allows us to run multiple npm scripts in parallel or sequentially.

Next, we will tweak the scripts a bit to this -

    "scripts": {
        "dev": "run-p dev:*",
        "dev:vite": "vite",
        "dev:tsc": "tsc --watch",
        "build": "tsc && vite build",
        "preview": "vite preview"
    },

You will see that now, the "dev" script has a 'run-p' command which runs both 'dev:vite' and 'dev:tsc' scripts in parallel. This is all thanks to this 'npm-run-all' package.

And now, when you run:

    npm run dev

You will see that the Vite dev server starts, and at the same time, the TypeScript compiler runs in watch mode. This way, you can see any type errors in the terminal while still being able to develop your application.
